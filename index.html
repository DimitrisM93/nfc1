<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC Wi-Fi Writer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background-color: #f3f4f6;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .scanning-pulse {
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 20px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="glass-panel w-full max-w-md rounded-2xl shadow-xl overflow-hidden">
        <!-- Header -->
        <div class="bg-blue-600 p-6 text-white text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                <i data-lucide="wifi" class="w-32 h-32 absolute -right-6 -bottom-6 transform rotate-12"></i>
            </div>
            <div class="relative z-10">
                <div class="mx-auto bg-white/20 w-16 h-16 rounded-full flex items-center justify-center mb-4 backdrop-blur-sm">
                    <i data-lucide="nfc" class="w-8 h-8 text-white"></i>
                </div>
                <h1 class="text-2xl font-bold">NFC Wi-Fi Writer</h1>
                <p class="text-blue-100 text-sm mt-1">Tap to share your network</p>
            </div>
        </div>

        <!-- Form -->
        <div class="p-6 space-y-5">
            
            <!-- Compatibility Warning (Hidden if supported) -->
            <div id="nfc-warning" class="hidden bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i data-lucide="alert-triangle" class="h-5 w-5 text-yellow-400"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-yellow-700">
                            Web NFC is not supported on this device/browser. Try Chrome on Android.
                        </p>
                    </div>
                </div>
            </div>

            <!-- SSID Input -->
            <div>
                <label for="ssid" class="block text-sm font-medium text-gray-700 mb-1">Network Name (SSID)</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="router" class="h-5 w-5 text-gray-400"></i>
                    </div>
                    <input type="text" id="ssid" class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="e.g. MyHomeWiFi">
                </div>
            </div>

            <!-- Password Input -->
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="lock" class="h-5 w-5 text-gray-400"></i>
                    </div>
                    <input type="password" id="password" class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="Network Key">
                    <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                        <i data-lucide="eye" class="h-5 w-5"></i>
                    </button>
                </div>
            </div>

            <!-- Security & Hidden Grid -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="security" class="block text-sm font-medium text-gray-700 mb-1">Security</label>
                    <div class="relative">
                        <select id="security" class="block w-full pl-3 pr-8 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white">
                            <option value="WPA">WPA/WPA2</option>
                            <option value="WEP">WEP</option>
                            <option value="nopass">None</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                            <i data-lucide="chevron-down" class="h-4 w-4"></i>
                        </div>
                    </div>
                </div>
                <div class="flex items-center h-full pt-6">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="hidden" class="sr-only peer">
                        <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        <span class="ms-3 text-sm font-medium text-gray-700">Hidden?</span>
                    </label>
                </div>
            </div>

            <!-- Action Button -->
            <button id="write-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-4 rounded-xl shadow-lg transform transition hover:-translate-y-0.5 active:translate-y-0 focus:outline-none focus:ring-4 focus:ring-blue-300 flex items-center justify-center gap-2">
                <i data-lucide="smartphone-nfc" class="w-5 h-5"></i>
                <span>Write to NFC Tag</span>
            </button>

            <!-- Log Area -->
            <div id="status-area" class="hidden rounded-lg p-4 text-sm mt-4 transition-all">
                <p id="status-text" class="text-center font-medium"></p>
            </div>
            
            <p class="text-xs text-gray-400 text-center mt-2">
                Requires Chrome on Android. Ensure NFC is enabled in settings.
            </p>
        </div>
    </div>

    <!-- Overlay for Scanning -->
    <div id="scan-overlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex-col items-center justify-center text-white p-6">
        <div class="bg-blue-500 rounded-full p-6 mb-8 scanning-pulse">
            <i data-lucide="radio" class="w-12 h-12"></i>
        </div>
        <h2 class="text-2xl font-bold mb-2">Ready to Write</h2>
        <p class="text-gray-300 text-center max-w-xs mb-8">Hold your device near an NFC tag to write the Wi-Fi credentials.</p>
        <button id="cancel-btn" class="bg-white/10 hover:bg-white/20 text-white border border-white/30 font-medium py-2 px-6 rounded-full transition-colors">
            Cancel
        </button>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // DOM Elements
        const ssidInput = document.getElementById('ssid');
        const passwordInput = document.getElementById('password');
        const togglePasswordBtn = document.getElementById('toggle-password');
        const securitySelect = document.getElementById('security');
        const hiddenCheck = document.getElementById('hidden');
        const writeBtn = document.getElementById('write-btn');
        const statusArea = document.getElementById('status-area');
        const statusText = document.getElementById('status-text');
        const nfcWarning = document.getElementById('nfc-warning');
        const scanOverlay = document.getElementById('scan-overlay');
        const cancelBtn = document.getElementById('cancel-btn');

        // Toggle Password Visibility
        togglePasswordBtn.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            const iconName = type === 'password' ? 'eye' : 'eye-off';
            
            // Re-render the specific icon
            togglePasswordBtn.innerHTML = `<i data-lucide="${iconName}" class="h-5 w-5"></i>`;
            lucide.createIcons({
                nameAttr: 'data-lucide',
                attrs: {class: "h-5 w-5"}
            });
        });

        // Check NFC Support
        if (!('NDEFReader' in window)) {
            nfcWarning.classList.remove('hidden');
            writeBtn.disabled = true;
            writeBtn.classList.add('opacity-50', 'cursor-not-allowed');
            writeBtn.innerHTML = "NFC Not Supported";
        }

        let abortController = null;

        // Write Function
        writeBtn.addEventListener('click', async () => {
            if (!ssidInput.value) {
                showStatus('Please enter a Network Name (SSID)', 'error');
                return;
            }

            // Construct Wi-Fi config string (MECARD/ZXing format commonly used for QR/NFC)
            // Format: WIFI:S:SSID;T:Type;P:Password;H:Hidden;;
            let wifiString = `WIFI:S:${ssidInput.value};`;
            
            const type = securitySelect.value;
            wifiString += `T:${type};`;

            if (type !== 'nopass') {
                wifiString += `P:${passwordInput.value};`;
            }

            if (hiddenCheck.checked) {
                wifiString += `H:true;`;
            }
            
            wifiString += `;`;

            startScanning(wifiString);
        });

        async function startScanning(dataToWrite) {
            try {
                abortController = new AbortController();
                const ndef = new NDEFReader();

                // Show overlay
                scanOverlay.classList.remove('hidden');
                scanOverlay.classList.add('flex');

                await ndef.write({
                    records: [{
                        recordType: "text",
                        data: dataToWrite
                    }]
                }, { signal: abortController.signal });

                // Success
                hideOverlay();
                showStatus('Successfully wrote Wi-Fi credentials to tag!', 'success');

            } catch (error) {
                hideOverlay();
                if (error.name === 'AbortError') {
                    // User cancelled, do nothing or simple log
                    showStatus('Write cancelled.', 'neutral');
                } else if (error.name === 'NotAllowedError') {
                    showStatus('NFC permission denied. Please allow NFC access.', 'error');
                } else if (error.name === 'NotSupportedError') {
                    showStatus('NFC not supported on this device/connection.', 'error');
                } else {
                    showStatus(`Write failed: ${error.message}`, 'error');
                }
            }
        }

        cancelBtn.addEventListener('click', () => {
            if (abortController) {
                abortController.abort();
                abortController = null;
            }
            hideOverlay();
        });

        function hideOverlay() {
            scanOverlay.classList.add('hidden');
            scanOverlay.classList.remove('flex');
        }

        function showStatus(message, type) {
            statusArea.classList.remove('hidden');
            statusText.textContent = message;

            // Reset classes
            statusArea.className = 'rounded-lg p-4 text-sm mt-4 transition-all border';

            if (type === 'success') {
                statusArea.classList.add('bg-green-50', 'text-green-700', 'border-green-200');
            } else if (type === 'error') {
                statusArea.classList.add('bg-red-50', 'text-red-700', 'border-red-200');
            } else {
                statusArea.classList.add('bg-gray-50', 'text-gray-700', 'border-gray-200');
            }
        }
    </script>
</body>
</html>